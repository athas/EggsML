#!/bin/sh
#
# Et godt citat fra en kendt person til at cementere en holdning eller
# sprede inspiration.
#
# Brug: citat [--ai]
#       citat - henter et tilfældigt citat fra databasen
#       citat --ai - bruger ChatGPT til at generere et passende citat

# Tjek hvor mange citater brugeren har bedt om for nylig
citat_count=$(dbUserRead "$EGGS_USER" citat_count)
if [ -z "$citat_count" ]; then
    citat_count=0
fi

# Nulstil tælleren hvis den er for gammel (mere end 1 time)
last_reset=$(dbUserRead "$EGGS_USER" citat_last_reset)
current_time=$(nowTime)
if [ -z "$last_reset" ] || [ $((current_time - last_reset)) -gt 3600 ]; then
    citat_count=0
    echo "$current_time" | dbUserWrite "$EGGS_USER" citat_last_reset
fi

# Opdater tælleren
citat_count=$((citat_count + 1))
echo "$citat_count" | dbUserWrite "$EGGS_USER" citat_count

# Skæld ud hvis brugeren har bedt om for mange citater
if [ $citat_count -gt 5 ] && [ $(random 1 3) = 1 ]; then
    skaelderier() {
        echo "Pokkers også! Er du saadan en tosse at du ikke kan tænke selv?"
        echo "Sikken en fjols! Kan du da slet ikke bruge dit eget hoved?"
        echo "Du er sandelig en kraftidiot! Tænk nu selv for en gangs skyld!"
        echo "Søren! Skal jeg blive ved med at tygge maden for dig, din dovne sjover?"
        echo "Pokker ta' mig! Kan du da ikke selv finde på noget fornuftigt?"
        echo "Din fæhovede! Brug dog dit eget snurretosse-hoved til noget!"
        echo "Skammens røde! Du tigger som en landstryger efter andres visdom!"
        echo "Din tosse og daare! Er du aldeles blottet for egen forstand?"
        echo "Søren spætte! Skal jeg virkelig blive ved med at belære dig?"
        echo "Du er en rigtig sinke! Lær dog at tænke med din egen hjerne!"
        echo "Din naragtige nar! Kan du ikke fatte at citater ikke gør dig klogere?"
        echo "Pokkers til sludder! Find dog selv på noget i stedet for at besvære mig!"
    }
    
    echo "$EGGS_USER: $(skaelderier | randomLine)"
    exit
fi

begrundelser() {
    echo "Dette citat vil uden tvivl bringe klarhed til debatten."
    echo "Som ordene fra denne vise person viser, er der intet mere at diskutere."
    echo "Dette citat rammer hovedet på sømmet og løser alle problemer."
    echo "Med disse ord i baghovedet kan vi alle blive enige."
    echo "Lad os alle reflektere over denne dybsindige visdom."
    echo "Disse ord vil helt sikkert inspirere og oplyse."
    echo "Dette er præcis hvad situationen kalder på."
    echo "Her har vi nøglen til at forstå hele problematikken."
    echo "Med denne indsigt er vejen frem nu krystalklar."
    echo "Dette citat bør læres udenad af enhver tænkende person."
    echo "Præcis sådan bør alle tænkende mennesker forholde sig til verden."
    echo "Denne indsigt ændrer alt."
    echo "Efter at have hørt dette, kan ingen være i tvivl."
    echo "Visdom som denne findes sjældent."
    echo "Dette burde skrives i guld på alle rådhuse."
}

if [ "$1" = "--ai" ]; then
    # Brug ChatGPT til at generere et citat
    prompt="Giv mig et dansk citat fra en kendt historisk person eller filosof. Formatet skal være: 'citattekst|personnavn'. Citatet skal være på dansk og kan være opdigtet men realistisk. Kun output citatet, intet andet."
    ai_citat=$(gpt4o 100 "$prompt")
    
    # Hvis AI-responset er tomt eller fejler, fall tilbage til database
    if [ -z "$ai_citat" ] || ! echo "$ai_citat" | grep -q '|'; then
        citat_og_person=$(cat "$CONCIEGGS_DB_DIR/citater" | randomLine)
    else
        citat_og_person="$ai_citat"
    fi
else
    # Hent fra databasen
    citat_og_person=$(cat "$CONCIEGGS_DB_DIR/citater" | randomLine)
fi

citat=$(echo "$citat_og_person" | cut -d'|' -f1)
person=$(echo "$citat_og_person" | cut -d'|' -f2)
begrundelse=$(begrundelser | randomLine)

echo "$EGGS_USER: \"$citat\" - $person"
echo "$EGGS_USER: $begrundelse"
