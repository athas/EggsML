#!/usr/bin/env python3
import sys
import urllib.parse
import subprocess

# Get API key from krakApiKey command
try:
    api_key = subprocess.run(['krakApiKey'], capture_output=True, text=True, check=True).stdout.strip()
except:
    print("Failed to get Krak API key", file=sys.stderr)
    sys.exit(1)

# Build URI with query parameters
params = {
    'profile': 'concieggs',
    'key': api_key,
    'country': 'dk',
    'version': '1.1.3',
    'geo_area': 'KÃ¸benhavn',
    'search_word': ' '.join(sys.argv[1:])
}

uri = 'https://api.eniro.com/cs/search/basic?' + urllib.parse.urlencode(params)

# Fetch with curl
try:
    result = subprocess.run(['curl', '-s', uri], capture_output=True, text=True, check=True)
    print(result.stdout.strip())
except:
    sys.exit(1)
