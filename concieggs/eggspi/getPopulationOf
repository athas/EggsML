#!/bin/sh

if [ $# -ne 1 ]; then
    echo "Brug: getPopulationOf <land>" >&2
    exit 1
fi

waOutput=$(wa "population of $1")

# Extract number and multiplier using grep/sed
result=$(echo "$waOutput" | grep -oE '(Result:|Summary: total\s+\|)\s+[0-9.]+\s+(people|million|billion)' | sed -E 's/(Result:|Summary: total\s+\|)\s+([0-9.]+)\s+(people|million|billion)/\2 \3/')

if [ -z "$result" ]; then
    echo "Unable to interpret population number. Got: $waOutput" >&2
    exit 1
fi

number=$(echo "$result" | awk '{print $1}')
multiplier=$(echo "$result" | awk '{print $2}')

if [ -z "$number" ] || [ -z "$multiplier" ]; then
    echo "Unable to interpret population number. Got: $waOutput" >&2
    exit 1
fi

# Calculate final population
case "$multiplier" in
    people)
        echo "$number" | awk '{printf "%.0f\n", $1}'
        ;;
    million)
        echo "$number" | awk '{printf "%.0f\n", $1 * 1000000}'
        ;;
    billion)
        echo "$number" | awk '{printf "%.0f\n", $1 * 1000000000}'
        ;;
    *)
        echo "Unable to interpret population number. Got: $waOutput" >&2
        exit 1
        ;;
esac
